// Admin Dashboard Translation Dictionary
// Pre-defined translations for instant language switching

const adminTranslations = {
    en: {
        // Navigation & Sidebar
        'Dashboard': 'Dashboard',
        'Packages': 'Packages',
        'Categories': 'Categories',
        'Hotels': 'Hotels',
        'Bookings': 'Bookings',
        'Users': 'Users',
        'Analytics': 'Analytics',
        'Management': 'Management',
        'System': 'System',
        'Help & Support': 'Help & Support',
        'Logout': 'Logout',
        'Administrator': 'Administrator',
        'Begin your Journey with Blessings': 'Begin your Journey with Blessings',
        
        // Common Actions
        'Add New': 'Add New',
        'Edit': 'Edit',
        'Delete': 'Delete',
        'View': 'View',
        'Save': 'Save',
        'Cancel': 'Cancel',
        'Submit': 'Submit',
        'Reset': 'Reset',
        'Apply Filters': 'Apply Filters',
        'Search': 'Search',
        'Search...': 'Search...',
        'Actions': 'Actions',
        'Back': 'Back',
        'Close': 'Close',
        'Confirm': 'Confirm',
        'Yes': 'Yes',
        'No': 'No',
        
        // Packages Page
        'All Packages': 'All Packages',
        'Add New Package': 'Add New Package',
        'Edit Package': 'Edit Package',
        'Package': 'Package',
        'Manage your travel packages and offerings': 'Manage your travel packages and offerings',
        'Search Packages': 'Search Packages',
        'Search by title...': 'Search by title...',
        'Category': 'Category',
        'All Categories': 'All Categories',
        'Status': 'Status',
        'All Status': 'All Status',
        'Active': 'Active',
        'Inactive': 'Inactive',
        'Total': 'Total',
        'Price': 'Price',
        'Hotel': 'Hotel',
        'No Hotel': 'No Hotel',
        'Uncategorized': 'Uncategorized',
        'No packages found': 'No packages found',
        'Get started by creating your first package': 'Get started by creating your first package',
        'Create Package': 'Create Package',
        'View Details': 'View Details',
        'Edit Package': 'Edit Package',
        'Delete Package': 'Delete Package',
        
        // Bookings Page
        'All Bookings': 'All Bookings',
        'Booking': 'Booking',
        'Booking Reference': 'Booking Reference',
        'Customer': 'Customer',
        'Customer Name': 'Customer Name',
        'Customer Email': 'Customer Email',
        'Customer Phone': 'Customer Phone',
        'Travel Date': 'Travel Date',
        'Return Date': 'Return Date',
        'Adults': 'Adults',
        'Children': 'Children',
        'Infants': 'Infants',
        'Total Amount': 'Total Amount',
        'Paid Amount': 'Paid Amount',
        'Remaining Amount': 'Remaining Amount',
        'Payment Status': 'Payment Status',
        'Paid': 'Paid',
        'Pending': 'Pending',
        'Partial': 'Partial',
        'Cancelled': 'Cancelled',
        'Confirmed': 'Confirmed',
        'Completed': 'Completed',
        'Special Requests': 'Special Requests',
        'Visa Required': 'Visa Required',
        'Number of Visas': 'Number of Visas',
        
        // Categories Page
        'All Categories': 'All Categories',
        'Add New Category': 'Add New Category',
        'Edit Category': 'Edit Category',
        'Category Name': 'Category Name',
        'Description': 'Description',
        'Packages Count': 'Packages Count',
        
        // Hotels Page
        'All Hotels': 'All Hotels',
        'Add New Hotel': 'Add New Hotel',
        'Edit Hotel': 'Edit Hotel',
        'Hotel Name': 'Hotel Name',
        'Location': 'Location',
        'Star Rating': 'Star Rating',
        'Amenities': 'Amenities',
        
        // Users Page
        'All Users': 'All Users',
        'Add New User': 'Add New User',
        'Edit User': 'Edit User',
        'User': 'User',
        'Name': 'Name',
        'Email': 'Email',
        'Phone': 'Phone',
        'Role': 'Role',
        'Admin': 'Admin',
        'Client': 'Client',
        'Created At': 'Created At',
        'Last Login': 'Last Login',
        
        // Form Labels
        'Title': 'Title',
        'Title (Arabic)': 'Title (Arabic)',
        'Description': 'Description',
        'Description (Arabic)': 'Description (Arabic)',
        'Image': 'Image',
        'Images': 'Images',
        'Upload Image': 'Upload Image',
        'Duration': 'Duration',
        'Days': 'Days',
        'Nights': 'Nights',
        'Features': 'Features',
        'Included': 'Included',
        'Excluded': 'Excluded',
        'Is Active': 'Is Active',
        'Select Category': 'Select Category',
        'Select Hotel': 'Select Hotel',
        
        // Messages
        'Success': 'Success',
        'Error': 'Error',
        'Warning': 'Warning',
        'Info': 'Info',
        'Loading...': 'Loading...',
        'Saving...': 'Saving...',
        'Deleting...': 'Deleting...',
        'Are you sure?': 'Are you sure?',
        'Are you sure you want to delete this?': 'Are you sure you want to delete this?',
        'This action cannot be undone': 'This action cannot be undone',
        'Successfully created': 'Successfully created',
        'Successfully updated': 'Successfully updated',
        'Successfully deleted': 'Successfully deleted',
        'Something went wrong': 'Something went wrong',
        'Please try again': 'Please try again',
        
        // Pagination
        'Showing': 'Showing',
        'to': 'to',
        'of': 'of',
        'results': 'results',
        'Previous': 'Previous',
        'Next': 'Next',
        
        // Dashboard
        'Welcome': 'Welcome',
        'Last login': 'Last login',
        'Today': 'Today',
        'This Week': 'This Week',
        'This Month': 'This Month',
        'Total Revenue': 'Total Revenue',
        'Total Bookings': 'Total Bookings',
        'Total Packages': 'Total Packages',
        'Total Users': 'Total Users',
        'Recent Bookings': 'Recent Bookings',
        'Recent Activity': 'Recent Activity',
        'View All': 'View All',
        
        // Support
        'Help & Support': 'Help & Support',
        'Contact Support': 'Contact Support',
        'FAQ': 'FAQ',
        'Documentation': 'Documentation',
    },
    ar: {
        // Navigation & Sidebar
        'Dashboard': 'لوحة التحكم',
        'Packages': 'الباقات',
        'Categories': 'الفئات',
        'Hotels': 'الفنادق',
        'Bookings': 'الحجوزات',
        'Users': 'المستخدمين',
        'Analytics': 'التحليلات',
        'Management': 'الإدارة',
        'System': 'النظام',
        'Help & Support': 'المساعدة والدعم',
        'Logout': 'تسجيل الخروج',
        'Administrator': 'مدير النظام',
        'Begin your Journey with Blessings': 'ابدأ رحلتك بالبركات',
        
        // Common Actions
        'Add New': 'إضافة جديد',
        'Edit': 'تعديل',
        'Delete': 'حذف',
        'View': 'عرض',
        'Save': 'حفظ',
        'Cancel': 'إلغاء',
        'Submit': 'إرسال',
        'Reset': 'إعادة تعيين',
        'Apply Filters': 'تطبيق الفلاتر',
        'Search': 'بحث',
        'Search...': 'بحث...',
        'Actions': 'الإجراءات',
        'Back': 'رجوع',
        'Close': 'إغلاق',
        'Confirm': 'تأكيد',
        'Yes': 'نعم',
        'No': 'لا',
        
        // Packages Page
        'All Packages': 'جميع الباقات',
        'Add New Package': 'إضافة باقة جديدة',
        'Edit Package': 'تعديل الباقة',
        'Package': 'الباقة',
        'Manage your travel packages and offerings': 'إدارة باقات السفر والعروض',
        'Search Packages': 'البحث في الباقات',
        'Search by title...': 'البحث بالعنوان...',
        'Category': 'الفئة',
        'All Categories': 'جميع الفئات',
        'Status': 'الحالة',
        'All Status': 'جميع الحالات',
        'Active': 'نشط',
        'Inactive': 'غير نشط',
        'Total': 'الإجمالي',
        'Price': 'السعر',
        'Hotel': 'الفندق',
        'No Hotel': 'بدون فندق',
        'Uncategorized': 'غير مصنف',
        'No packages found': 'لم يتم العثور على باقات',
        'Get started by creating your first package': 'ابدأ بإنشاء باقتك الأولى',
        'Create Package': 'إنشاء باقة',
        'View Details': 'عرض التفاصيل',
        'Delete Package': 'حذف الباقة',
        
        // Bookings Page
        'All Bookings': 'جميع الحجوزات',
        'Booking': 'الحجز',
        'Booking Reference': 'رقم الحجز',
        'Customer': 'العميل',
        'Customer Name': 'اسم العميل',
        'Customer Email': 'بريد العميل',
        'Customer Phone': 'هاتف العميل',
        'Travel Date': 'تاريخ السفر',
        'Return Date': 'تاريخ العودة',
        'Adults': 'البالغين',
        'Children': 'الأطفال',
        'Infants': 'الرضع',
        'Total Amount': 'المبلغ الإجمالي',
        'Paid Amount': 'المبلغ المدفوع',
        'Remaining Amount': 'المبلغ المتبقي',
        'Payment Status': 'حالة الدفع',
        'Paid': 'مدفوع',
        'Pending': 'قيد الانتظار',
        'Partial': 'جزئي',
        'Cancelled': 'ملغي',
        'Confirmed': 'مؤكد',
        'Completed': 'مكتمل',
        'Special Requests': 'طلبات خاصة',
        'Visa Required': 'تأشيرة مطلوبة',
        'Number of Visas': 'عدد التأشيرات',
        
        // Categories Page
        'Add New Category': 'إضافة فئة جديدة',
        'Edit Category': 'تعديل الفئة',
        'Category Name': 'اسم الفئة',
        'Description': 'الوصف',
        'Packages Count': 'عدد الباقات',
        
        // Hotels Page
        'All Hotels': 'جميع الفنادق',
        'Add New Hotel': 'إضافة فندق جديد',
        'Edit Hotel': 'تعديل الفندق',
        'Hotel Name': 'اسم الفندق',
        'Location': 'الموقع',
        'Star Rating': 'التصنيف بالنجوم',
        'Amenities': 'المرافق',
        
        // Users Page
        'All Users': 'جميع المستخدمين',
        'Add New User': 'إضافة مستخدم جديد',
        'Edit User': 'تعديل المستخدم',
        'User': 'المستخدم',
        'Name': 'الاسم',
        'Email': 'البريد الإلكتروني',
        'Phone': 'الهاتف',
        'Role': 'الدور',
        'Admin': 'مدير',
        'Client': 'عميل',
        'Created At': 'تاريخ الإنشاء',
        'Last Login': 'آخر تسجيل دخول',
        
        // Form Labels
        'Title': 'العنوان',
        'Title (Arabic)': 'العنوان (بالعربية)',
        'Description (Arabic)': 'الوصف (بالعربية)',
        'Image': 'الصورة',
        'Images': 'الصور',
        'Upload Image': 'رفع صورة',
        'Duration': 'المدة',
        'Days': 'أيام',
        'Nights': 'ليالي',
        'Features': 'المميزات',
        'Included': 'يشمل',
        'Excluded': 'لا يشمل',
        'Is Active': 'نشط',
        'Select Category': 'اختر الفئة',
        'Select Hotel': 'اختر الفندق',
        
        // Messages
        'Success': 'نجاح',
        'Error': 'خطأ',
        'Warning': 'تحذير',
        'Info': 'معلومات',
        'Loading...': 'جاري التحميل...',
        'Saving...': 'جاري الحفظ...',
        'Deleting...': 'جاري الحذف...',
        'Are you sure?': 'هل أنت متأكد؟',
        'Are you sure you want to delete this?': 'هل أنت متأكد من حذف هذا؟',
        'This action cannot be undone': 'لا يمكن التراجع عن هذا الإجراء',
        'Successfully created': 'تم الإنشاء بنجاح',
        'Successfully updated': 'تم التحديث بنجاح',
        'Successfully deleted': 'تم الحذف بنجاح',
        'Something went wrong': 'حدث خطأ ما',
        'Please try again': 'يرجى المحاولة مرة أخرى',
        
        // Pagination
        'Showing': 'عرض',
        'to': 'إلى',
        'of': 'من',
        'results': 'نتيجة',
        'Previous': 'السابق',
        'Next': 'التالي',
        
        // Dashboard
        'Welcome': 'مرحباً',
        'Last login': 'آخر تسجيل دخول',
        'Today': 'اليوم',
        'This Week': 'هذا الأسبوع',
        'This Month': 'هذا الشهر',
        'Total Revenue': 'إجمالي الإيرادات',
        'Total Bookings': 'إجمالي الحجوزات',
        'Total Packages': 'إجمالي الباقات',
        'Total Users': 'إجمالي المستخدمين',
        'Recent Bookings': 'الحجوزات الأخيرة',
        'Recent Activity': 'النشاط الأخير',
        'View All': 'عرض الكل',
        
        // Support
        'Contact Support': 'اتصل بالدعم',
        'FAQ': 'الأسئلة الشائعة',
        'Documentation': 'التوثيق',
    }
};

// Current language state
let currentLang = localStorage.getItem('adminLang') || 'en';

// Get translation for a key
function t(key) {
    return adminTranslations[currentLang][key] || key;
}

// Translate a single text
function translateString(text, targetLang) {
    const trimmedText = text.trim();
    if (!trimmedText) return text;
    
    const translation = adminTranslations[targetLang][trimmedText];
    if (translation) {
        // Preserve leading/trailing whitespace
        const leadingSpace = text.match(/^\s*/)[0];
        const trailingSpace = text.match(/\s*$/)[0];
        return leadingSpace + translation + trailingSpace;
    }
    return text;
}

// Get all translatable text nodes
function getTranslatableNodes(element) {
    const nodes = [];
    const walker = document.createTreeWalker(element, NodeFilter.SHOW_TEXT, {
        acceptNode: function(node) {
            const parent = node.parentElement;
            if (!parent || 
                parent.tagName === 'SCRIPT' || 
                parent.tagName === 'STYLE' || 
                parent.tagName === 'NOSCRIPT' ||
                parent.tagName === 'TEXTAREA' ||
                parent.isContentEditable ||
                !node.textContent.trim()) {
                return NodeFilter.FILTER_REJECT;
            }
            return NodeFilter.FILTER_ACCEPT;
        }
    });
    
    let node;
    while (node = walker.nextNode()) {
        nodes.push(node);
    }
    return nodes;
}

// Store original texts
const originalTexts = new Map();

// Apply RTL styles
function applyRTLStyles() {
    if (document.getElementById('admin-rtl-styles')) return;
    
    const style = document.createElement('style');
    style.id = 'admin-rtl-styles';
    style.textContent = `
        html[dir="rtl"] {
            font-family: 'Cairo', 'Inter', sans-serif;
        }
        html[dir="rtl"] aside { 
            right: 0 !important; 
            left: auto !important; 
            transform: translateX(0) !important;
        }
        html[dir="rtl"] aside.sidebar-transition.-translate-x-full {
            transform: translateX(100%) !important;
        }
        html[dir="rtl"] .md\\:translate-x-0 { 
            transform: translateX(0) !important; 
        }
        html[dir="rtl"] .ml-auto { 
            margin-left: 0 !important; 
            margin-right: auto !important; 
        }
        html[dir="rtl"] .mr-auto { 
            margin-right: 0 !important; 
            margin-left: auto !important; 
        }
        html[dir="rtl"] .mr-2, html[dir="rtl"] .mr-3, html[dir="rtl"] .mr-4 { 
            margin-right: 0 !important; 
        }
        html[dir="rtl"] .mr-2 { margin-left: 0.5rem !important; }
        html[dir="rtl"] .mr-3 { margin-left: 0.75rem !important; }
        html[dir="rtl"] .mr-4 { margin-left: 1rem !important; }
        html[dir="rtl"] .ml-2, html[dir="rtl"] .ml-3, html[dir="rtl"] .ml-4 { 
            margin-left: 0 !important; 
        }
        html[dir="rtl"] .ml-2 { margin-right: 0.5rem !important; }
        html[dir="rtl"] .ml-3 { margin-right: 0.75rem !important; }
        html[dir="rtl"] .ml-4 { margin-right: 1rem !important; }
        html[dir="rtl"] .space-x-2 > * + *, 
        html[dir="rtl"] .space-x-3 > * + *, 
        html[dir="rtl"] .space-x-4 > * + *,
        html[dir="rtl"] .space-x-6 > * + * {
            margin-left: 0 !important;
        }
        html[dir="rtl"] .space-x-2 > * + * { margin-right: 0.5rem !important; }
        html[dir="rtl"] .space-x-3 > * + * { margin-right: 0.75rem !important; }
        html[dir="rtl"] .space-x-4 > * + * { margin-right: 1rem !important; }
        html[dir="rtl"] .space-x-6 > * + * { margin-right: 1.5rem !important; }
        html[dir="rtl"] .pl-3, html[dir="rtl"] .pl-4, html[dir="rtl"] .pl-10 {
            padding-left: 0 !important;
        }
        html[dir="rtl"] .pl-3 { padding-right: 0.75rem !important; }
        html[dir="rtl"] .pl-4 { padding-right: 1rem !important; }
        html[dir="rtl"] .pl-10 { padding-right: 2.5rem !important; }
        html[dir="rtl"] .pr-3, html[dir="rtl"] .pr-4 {
            padding-right: 0 !important;
        }
        html[dir="rtl"] .pr-3 { padding-left: 0.75rem !important; }
        html[dir="rtl"] .pr-4 { padding-left: 1rem !important; }
        html[dir="rtl"] .left-0 { 
            left: auto !important; 
            right: 0 !important; 
        }
        html[dir="rtl"] .right-0 { 
            right: auto !important; 
            left: 0 !important; 
        }
        html[dir="rtl"] .text-left { 
            text-align: right !important; 
        }
        html[dir="rtl"] .text-right { 
            text-align: left !important; 
        }
        html[dir="rtl"] .border-l { 
            border-left: 0 !important; 
            border-right-width: 1px !important; 
        }
        html[dir="rtl"] .border-r { 
            border-right: 0 !important; 
            border-left-width: 1px !important; 
        }
        html[dir="rtl"] .active-nav-item::before {
            left: auto !important;
            right: 0 !important;
            border-radius: 4px 0 0 4px !important;
        }
        html[dir="rtl"] input[type="text"],
        html[dir="rtl"] input[type="email"],
        html[dir="rtl"] input[type="search"],
        html[dir="rtl"] textarea,
        html[dir="rtl"] select {
            text-align: right;
        }
        html[dir="rtl"] table th,
        html[dir="rtl"] table td {
            text-align: right !important;
        }
        html[dir="rtl"] .inset-y-0.left-0 {
            left: auto !important;
            right: 0 !important;
        }
        html[dir="rtl"] .notification-dot {
            right: auto !important;
            left: 8px !important;
        }
    `;
    document.head.appendChild(style);
    
    // Load Arabic font
    if (!document.getElementById('arabic-font-link')) {
        const link = document.createElement('link');
        link.id = 'arabic-font-link';
        link.href = 'https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;500;600;700&display=swap';
        link.rel = 'stylesheet';
        document.head.appendChild(link);
    }
}

// Remove RTL styles
function removeRTLStyles() {
    const style = document.getElementById('admin-rtl-styles');
    if (style) style.remove();
}

// Switch to Arabic - INSTANT!
function switchToArabic() {
    currentLang = 'ar';
    localStorage.setItem('adminLang', 'ar');
    
    // Set document direction
    document.documentElement.setAttribute('dir', 'rtl');
    document.documentElement.setAttribute('lang', 'ar');
    
    // Apply RTL styles
    applyRTLStyles();
    
    // Translate all text nodes
    const nodes = getTranslatableNodes(document.body);
    nodes.forEach(node => {
        if (!originalTexts.has(node)) {
            originalTexts.set(node, node.textContent);
        }
        node.textContent = translateString(node.textContent, 'ar');
    });
    
    // Translate placeholders
    document.querySelectorAll('[placeholder]').forEach(el => {
        if (!el.dataset.originalPlaceholder) {
            el.dataset.originalPlaceholder = el.placeholder;
        }
        el.placeholder = translateString(el.placeholder, 'ar');
    });
    
    // Translate title attributes
    document.querySelectorAll('[title]').forEach(el => {
        if (!el.dataset.originalTitle) {
            el.dataset.originalTitle = el.title;
        }
        el.title = translateString(el.title, 'ar');
    });
    
    // Update language button
    updateLangButton('English');
}

// Switch to English - INSTANT!
function switchToEnglish() {
    currentLang = 'en';
    localStorage.setItem('adminLang', 'en');
    
    // Set document direction
    document.documentElement.setAttribute('dir', 'ltr');
    document.documentElement.setAttribute('lang', 'en');
    
    // Remove RTL styles
    removeRTLStyles();
    
    // Restore original texts
    originalTexts.forEach((original, node) => {
        if (node.parentNode) {
            node.textContent = original;
        }
    });
    
    // Restore placeholders
    document.querySelectorAll('[data-original-placeholder]').forEach(el => {
        el.placeholder = el.dataset.originalPlaceholder;
    });
    
    // Restore title attributes
    document.querySelectorAll('[data-original-title]').forEach(el => {
        el.title = el.dataset.originalTitle;
    });
    
    // Update language button
    updateLangButton('العربية');
}

// Update language button text
function updateLangButton(text) {
    const btn = document.getElementById('lang-btn');
    if (btn) {
        const span = btn.querySelector('span');
        if (span) span.textContent = text;
    }
}

// Toggle language
function toggleLanguage() {
    if (currentLang === 'ar') {
        switchToEnglish();
    } else {
        switchToArabic();
    }
}

// Initialize on page load
document.addEventListener('DOMContentLoaded', () => {
    const savedLang = localStorage.getItem('adminLang');
    if (savedLang === 'ar') {
        // Small delay to ensure DOM is fully ready
        setTimeout(() => {
            switchToArabic();
        }, 100);
    }
    console.log('Admin Translations loaded - Instant language switching enabled!');
});

// Export for use in other scripts
window.adminTranslations = adminTranslations;
window.t = t;
window.toggleLanguage = toggleLanguage;
window.switchToArabic = switchToArabic;
window.switchToEnglish = switchToEnglish;
